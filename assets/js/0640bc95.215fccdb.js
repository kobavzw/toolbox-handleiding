"use strict";(self.webpackChunktoolbox_handleiding=self.webpackChunktoolbox_handleiding||[]).push([[6428],{52754:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>p,frontMatter:()=>i,metadata:()=>r,toc:()=>l});var t=s(85893),a=s(11151);const i={title:"Synchronisatie met ActiveDirectory"},o=void 0,r={id:"synchronisatie/synchronisatie_AD/index",title:"Synchronisatie met ActiveDirectory",description:"Aangezien Toolbox in de cloud draait en moet kunnen communiceren met de ActiveDirectory die (meestal) in de school draait, werd een bijkomende component 'Toolbox Gateway' ontwikkeld.",source:"@site/docs/synchronisatie/4-synchronisatie_AD/index.mdx",sourceDirName:"synchronisatie/4-synchronisatie_AD",slug:"/synchronisatie/synchronisatie_AD/",permalink:"/synchronisatie/synchronisatie_AD/",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{title:"Synchronisatie met ActiveDirectory"},sidebar:"tutorialSidebar",previous:{title:"Synchronisatie externen",permalink:"/synchronisatie/synchronisatie_externen/"},next:{title:"Synchronisatie Exact Online",permalink:"/synchronisatie/synchronisatie_EOL/"}},d={},l=[{value:"Webserver installeren",id:"webserver-installeren",level:2},{value:"PHP op de webserver installeren",id:"php-op-de-webserver-installeren",level:2},{value:"Toolbox gateway AD installeren",id:"toolbox-gateway-ad-installeren",level:2}];function c(e){const n={a:"a",code:"code",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.a)(),...e.components},{Thumbnails:i}=n;return i||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Thumbnails",!0),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"Aangezien Toolbox in de cloud draait en moet kunnen communiceren met de ActiveDirectory die (meestal) in de school draait, werd een bijkomende component 'Toolbox Gateway' ontwikkeld."}),"\n",(0,t.jsx)(n.p,{children:"Toolbox Gateway draait op de AD of op een machine die verbonden is met de AD. De gateway bestaat uit een webserver (IIS) en enkele PHP/Powershell scripts. Die zorgen voor een beveiligde verbinding tussen Toolbox en de ActiveDirectory."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"ActiveDirectory",src:s(71754).Z+"",width:"2380",height:"594"})}),"\n",(0,t.jsx)(n.h2,{id:"webserver-installeren",children:"Webserver installeren"}),"\n",(0,t.jsx)(n.p,{children:"Om Toolbox te laten communiceren met de ActiveDirectory in de school, moeten we de Toolbox Gateway installeren. Die vereist eerst en vooral de installatie van een Webserver (IIS) die PHP kan draaien."}),"\n",(0,t.jsx)(n.p,{children:"De webserver mag ge\xefnstalleerd worden op de ActiveDirectory server zelf of op een (virtuele) Windows server in het netwerk van de school die ook lid is van het AD domein."}),"\n",(0,t.jsx)(n.p,{children:"Voeg eerst en vooral een 'Rol' toe via de server manager."}),"\n",(0,t.jsx)(i,{img:[s(19233).Z,s(46127).Z,s(31453).Z,s(48463).Z]}),"\n",(0,t.jsx)(n.p,{children:"Vink Web Server (IIS) aan"}),"\n",(0,t.jsx)(i,{img:[s(48147).Z]}),"\n",(0,t.jsx)(n.p,{children:"Installeer de Management Console mee (staat standaard aan)."}),"\n",(0,t.jsx)(i,{img:[s(83406).Z]}),"\n",(0,t.jsx)(n.p,{children:"In het volgende scherm vink je de module Active Directory for powershell aan."}),"\n",(0,t.jsx)(i,{img:[s(95137).Z]}),"\n",(0,t.jsx)(n.p,{children:"In het scherm 'Select role services' vink je onder Application Development de optie 'CGI' aan."}),"\n",(0,t.jsx)(i,{img:[s(34034).Z,s(59335).Z]}),"\n",(0,t.jsx)(n.p,{children:"Bevestig"}),"\n",(0,t.jsx)(i,{img:[s(53845).Z,s(13514).Z]}),"\n",(0,t.jsx)(n.p,{children:"Ben je hiermee klaar, ga dan verder: PHP installeren op je webserver"}),"\n",(0,t.jsx)(n.h2,{id:"php-op-de-webserver-installeren",children:"PHP op de webserver installeren"}),"\n",(0,t.jsxs)(n.p,{children:["Ga naar ",(0,t.jsx)(n.a,{href:"https://windows.php.net",children:"https://windows.php.net"})," - Downloads"]}),"\n",(0,t.jsx)(n.p,{children:"Download daar de X64 Non Thread Safe versie van PHP (in zip formaat)."}),"\n",(0,t.jsx)(i,{img:[s(23954).Z,s(91936).Z]}),"\n",(0,t.jsx)(n.p,{children:"Pak dit zip-bestand uit in de locatie c:\\php."}),"\n",(0,t.jsx)(i,{img:[s(37317).Z]}),"\n",(0,t.jsx)(n.p,{children:"Om te testen of PHP werkt, dubbelklik je op php-cgi.exe. Als je een foutmelding krijgt over een ontbrekende DLL, dan moet je de C++ redistributable 2015-2019 installeren."}),"\n",(0,t.jsx)(n.p,{children:"The VC15 and VS16 builds require to have the Visual C++ Redistributable for Visual Studio 2015-2019 x64 or x86 installed."}),"\n",(0,t.jsx)(n.p,{children:"Zorg eerst dat PHP opstart alvorens verder te gaan!"}),"\n",(0,t.jsx)(n.p,{children:"Wijzig de naam van het bestand php.ini-production naar php.ini."}),"\n",(0,t.jsx)(n.p,{children:"Open het bestand en zoek naar fastcgi.impersonate = 1. Haal daar de puntkomma voor die lijn weg en bewaar het bestand. Activeer ook de extensie openssl: extension=openssl (puntkomma verwijderen voor deze lijn)."}),"\n",(0,t.jsx)(i,{img:[s(47152).Z]}),"\n",(0,t.jsx)(n.p,{children:"Ga naar de Internet Information Services Manager."}),"\n",(0,t.jsx)(i,{img:[s(7372).Z]}),"\n",(0,t.jsx)(n.p,{children:"Ga naar de Handler Mappings en voeg een Module Mapping toe."}),"\n",(0,t.jsx)(i,{img:[s(14430).Z]}),"\n",(0,t.jsx)(n.p,{children:"Vul volgende instellingen in:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Request path: *.php"}),"\n",(0,t.jsx)(n.li,{children:"Module: FastCgiModule"}),"\n",(0,t.jsx)(n.li,{children:"Executable: C:\\php\\php-cgi.exe"}),"\n",(0,t.jsx)(n.li,{children:"Name: PHP via FastCGI"}),"\n"]}),"\n",(0,t.jsx)(i,{img:[s(6065).Z]}),"\n",(0,t.jsx)(n.p,{children:"Maak nu door middel van Kladblok een testbestand aan in de map c:\\inetpub\\wwwroot.\nNoem dit bestand test.php (let op daar er geen verborgen .txt extensie achter staat).\nIn het bestand zet je deze inhoud:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"    <?php\n    phpinfo();\n    ?>\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Surf nu op de server naar ",(0,t.jsx)(n.a,{href:"http://localhost/test.php",children:"http://localhost/test.php"}),". Als alles goed gaat, krijg je deze pagina te zien:"]}),"\n",(0,t.jsx)(i,{img:[s(40099).Z]}),"\n",(0,t.jsx)(n.h2,{id:"toolbox-gateway-ad-installeren",children:"Toolbox gateway AD installeren"}),"\n",(0,t.jsxs)(n.p,{children:["Download de laatste versie van Toolbox Gateway op ",(0,t.jsx)(n.a,{href:"https://www.tbvs.be/downloads/ToolboxGateway1_5_0.zip",children:"https://www.tbvs.be/downloads/ToolboxGateway1_5_0.zip"})," (versie 01 februari 2023)."]}),"\n",(0,t.jsx)(n.p,{children:"Plaats de uitgepakte map op de C: schijf en hernoem de map naar toolbox."}),"\n",(0,t.jsx)(n.p,{children:"Als je de Toolbox Gateway enkel gebruikt voor de communicatie met de ActiveDirectory, mag je de mappen 'poorten' en 'uniflow_edu' verwijderen uit de map php."}),"\n",(0,t.jsx)(n.p,{children:"De mappen zien er dan zo uit:"}),"\n",(0,t.jsx)(i,{img:[s(59269).Z,s(5079).Z]}),"\n",(0,t.jsx)(n.p,{children:"Ga naar de map powershell en selecteer het eerste powershell-script. Klik rechts en vraag de eigenschappen op. Mogelijk krijg je onderaan een 'Security' melding. Vink dan het vinkje bij Unblock aan en bevestig met OK. Herhaal dit voor de andere powershell-scripts."}),"\n",(0,t.jsx)(i,{img:[s(22376).Z]}),"\n",(0,t.jsx)(n.p,{children:"Ga naar het IIS-beheer, klap het menu links open en selecteer de Default Website. Klik rechts en voeg een virtuele map toe."}),"\n",(0,t.jsx)(i,{img:[s(2963).Z]}),"\n",(0,t.jsx)(n.p,{children:"Als Alias vul je \u2018toolbox\u2019 in."}),"\n",(0,t.jsx)(n.p,{children:"Bij Fysiek pad, selecteer je de php map in de Toolbox Gateway (c:\\toolbox\\php)."}),"\n",(0,t.jsx)(n.p,{children:"Bij verbinden als vul je een Administrator in die mag schrijven in de ActiveDirectory."}),"\n",(0,t.jsx)(i,{img:[s(1897).Z]}),"\n",(0,t.jsx)(n.p,{children:"Ga naar de map php - inc en open het bestand config.php."}),"\n",(0,t.jsxs)(n.p,{children:["In de variabele ",(0,t.jsx)(n.code,{children:"$toolbox_url = ''"}),"; Vul je het adres van je Toolbox in. bv. ",(0,t.jsx)(n.code,{children:"$toolbox_url = 'https://piusx.kobam.be';"})," of ",(0,t.jsx)(n.code,{children:"$toolbox_url = 'https://mijnschool.tbvs.be';"})]}),"\n",(0,t.jsxs)(n.p,{children:["In de variabele ",(0,t.jsx)(n.code,{children:"$ad_key"})," zet je een zelfgemaakte willekeurige sleutel die cijfers en (hoofd)letters bevat. bv.\n",(0,t.jsx)(n.code,{children:"$ad_key = 'v4ZD7RJ9Xsd8947E7beV4SvY4rfeDqhDil'"}),";"]}),"\n",(0,t.jsx)(n.p,{children:"Als je de Toolbox Gateway enkel gebruikt voor de communicatie met ActiveDirectory mag je de uniflow_key en de poort_key negeren."}),"\n",(0,t.jsxs)(n.p,{children:["In de lijst van ",(0,t.jsx)(n.code,{children:"$allowed_ips"})," voeg je het IP-adres van je Toolbox toe. Staat je Toolbox op de tbvs.be server, dan is dat IP 217.19.239.174: ",(0,t.jsx)(n.code,{children:"$allowed_ips = array('217.19.239.174')"}),";"]}),"\n",(0,t.jsx)(n.p,{children:"Configureer vervolgens op je firewall van de school \xe9\xe9n poortforwarding zodat de webserver (IIS) die je hebt ge\xefnstalleerd van buitenaf toegankelijk is. Welke poort je gebruikt, mag je zelf kiezen."}),"\n",(0,t.jsx)(n.p,{children:"Ga nu naar je Toolbox - Instellingen - ActiveDirectory. In het onderdeel Gateway vul je nu volgende gegevens in:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Push Key: de sleutel die je in de variabele $ad_key hebt gezet"}),"\n",(0,t.jsx)(n.li,{children:"URL Gateway: de URL waarop je je webserver kan bereiken."}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Dat kan via een (vast) IP adres zijn: bv. ",(0,t.jsx)(n.a,{href:"http://12.34.56.78/toolbox/",children:"http://12.34.56.78/toolbox/"})," (als je poort 80 hebt gebruikt) of ",(0,t.jsx)(n.a,{href:"http://12.34.56.78:8001/toolbox/",children:"http://12.34.56.78:8001/toolbox/"})," als je een portforwarding op poort 8001 hebt gemaakt.\nBij de toegelaten IP-adressen vul je het IP-adres van je Toolbox Gateway in (meestal is dat hetzelfde als dat van de URL van je Toolbox). Je kan meerdere IP-adressen invullen door ze met komma's te scheiden (bv. als je meerdere gateways hebt voor je internetverbinding).\nKlik nu op Test gateway om te kijken of Toolbox verbinding kan maken met je Toolbox Gateway."]}),"\n",(0,t.jsx)(i,{img:[s(78468).Z]}),"\n",(0,t.jsx)(n.p,{children:"Vul nu in de instellingen in Toolbox - ActiveDirectory de standaard OU voor bv. leraren in. Ga dan naar de synchronisatie Leraren - Synchroniseer met ActiveDirectory. Klik vervolgens op Start volledige synchronisatie en kijk of er resultaten doorkomen."}),"\n",(0,t.jsx)(n.p,{children:"Indien er geen resultaten doorkomen, controleer je of de PowerShell scripts uitgevoerd kunnen worden. Dat doe je op de Toolbox Gateway server. Selecteer in de map c:\\toolbox\\powershell het bestand getLerarenJson.ps en kies om te bewerken. Voer het script uit en vul de OU in. Hier zal je nu json output moeten doorkrijgen. Krijg je fouten over unsigned scripts, voer dan deze twee commando's uit als administrator (PowerShell opstarten als administrator):"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-powershell",children:"Set-ExecutionPolicy -ExecutionPolicy Unrestricted\ndir C:\\toolbox\\PowerShell\\* | Unblock-File\n"})})]})}function p(e={}){const{wrapper:n}={...(0,a.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},23954:(e,n,s)=>{s.d(n,{Z:()=>t});const t=s.p+"assets/images/PHP1-f923e77b4afd1a316f39e7f8087b1cd9.png"},91936:(e,n,s)=>{s.d(n,{Z:()=>t});const t=s.p+"assets/images/PHP2-96969773c356f4bee056d3a24ef20bd2.png"},37317:(e,n,s)=>{s.d(n,{Z:()=>t});const t=s.p+"assets/images/PHP3-54ebf6f30a22d89a0b141fa4072d2dc2.png"},47152:(e,n,s)=>{s.d(n,{Z:()=>t});const t=s.p+"assets/images/PHP4-980cf6862bbccc97b0671f3596911538.png"},7372:(e,n,s)=>{s.d(n,{Z:()=>t});const t=s.p+"assets/images/PHP5-f5414c086ef2e56d067159a9d29ab525.png"},14430:(e,n,s)=>{s.d(n,{Z:()=>t});const t=s.p+"assets/images/PHP6-c145f1d1175fa1e209cba2b9bb6bde1e.png"},6065:(e,n,s)=>{s.d(n,{Z:()=>t});const t=s.p+"assets/images/PHP7-c83550e882c051a0378973eb59808382.png"},40099:(e,n,s)=>{s.d(n,{Z:()=>t});const t=s.p+"assets/images/PHP8-c474e8c4eb4bebc5155146d2fb74fcc5.png"},59269:(e,n,s)=>{s.d(n,{Z:()=>t});const t=s.p+"assets/images/gateway1-e49ea6d144f82ee32e152d96844fb59b.png"},5079:(e,n,s)=>{s.d(n,{Z:()=>t});const t=s.p+"assets/images/gateway2-858124e6d9baa4f94bebed44d6da590f.png"},22376:(e,n,s)=>{s.d(n,{Z:()=>t});const t=s.p+"assets/images/gateway3-ed53fa02aea91507bd08af42adbce1e1.png"},2963:(e,n,s)=>{s.d(n,{Z:()=>t});const t=s.p+"assets/images/gateway4-aebdd29ff65e256e603a8cd8244240b1.png"},1897:(e,n,s)=>{s.d(n,{Z:()=>t});const t=s.p+"assets/images/gateway5-d15e924911df6e725d7750c2ce4a7b2e.png"},78468:(e,n,s)=>{s.d(n,{Z:()=>t});const t=s.p+"assets/images/gateway6-04704355d131c4ae863b901b2e7ad473.png"},19233:(e,n,s)=>{s.d(n,{Z:()=>t});const t=s.p+"assets/images/webserver1-824be80b16dbca4c872ca6206ef60914.png"},53845:(e,n,s)=>{s.d(n,{Z:()=>t});const t=s.p+"assets/images/webserver10-3945ac8b11f27aee126d9d02ca3d958b.png"},13514:(e,n,s)=>{s.d(n,{Z:()=>t});const t=s.p+"assets/images/webserver11-47424c04fb5059827f4408b0867a5f3d.png"},46127:(e,n,s)=>{s.d(n,{Z:()=>t});const t=s.p+"assets/images/webserver2-2224607d63cae52d4fc73ee241eabc20.png"},31453:(e,n,s)=>{s.d(n,{Z:()=>t});const t=s.p+"assets/images/webserver3-e2dec1fc7082d8a9388160145f4be76a.png"},48463:(e,n,s)=>{s.d(n,{Z:()=>t});const t=s.p+"assets/images/webserver4-963839391ef5693523a084c180b13fc4.png"},48147:(e,n,s)=>{s.d(n,{Z:()=>t});const t=s.p+"assets/images/webserver5-97641488b2e15b3244702c3636f1e75b.png"},83406:(e,n,s)=>{s.d(n,{Z:()=>t});const t=s.p+"assets/images/webserver6-528f2a976c45d7cd7ff505b383df1e69.png"},95137:(e,n,s)=>{s.d(n,{Z:()=>t});const t=s.p+"assets/images/webserver7-17d8b9c6bb2864fbcb570c17c6fb5321.png"},34034:(e,n,s)=>{s.d(n,{Z:()=>t});const t=s.p+"assets/images/webserver8-31218cc65c0255522af677ff3f3cb74e.png"},59335:(e,n,s)=>{s.d(n,{Z:()=>t});const t=s.p+"assets/images/webserver9-a484c3b0fc0ebe2d8394a822ec9faf43.png"},71754:(e,n,s)=>{s.d(n,{Z:()=>t});const t=s.p+"assets/images/SchemaADGateway-781f59cecf78266a126953fa504c3fde.png"},11151:(e,n,s)=>{s.d(n,{Z:()=>r,a:()=>o});var t=s(67294);const a={},i=t.createContext(a);function o(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);